<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>mod_auth_openid</title>
    <link href="css/stylesheet.css" type="text/css" rel="stylesheet" />
    <link href="css/syntax.css" type="text/css" rel="stylesheet" />
  </head>
  <body>
    <div id="header">
      <div>mod_auth_openid</div>
      <div id="subheader">the openid module for apache</div>
      <div id="menu">
	<ul>
	  <li><a href="index.html">home</a></li>
	  <li><a href="faq.html">faq</a></li>
	  <li><a href="releases.html">releases</a></li>
	</ul>
      </div>
    </div>
    <div id="content">
      <h1 id='introduction__the_apache_openid_module'>Introduction : The Apache OpenID Module</h1>

<p><strong>mod_auth_openid</strong> is an authentication module for the <a href='http://httpd.apache.org'>Apache 2</a> webserver. It handles the functions of an <a href='http://openid.net'>OpenID</a> consumer as specified in the <a href='http://openid.net/specs/openid-authentication-2_0.html'>OpenID 2.0 specification</a>. See the <a href='faq.html'>FAQ</a> for more information. Download the current release from the <a href='releases.html'>the releases page</a>.</p>

<p>You can, now, specify an external program for authorization. That is, after a user has authenticated themselves their identity can be passed to an external program that then returns a value that either authorize them or not to see the resource being protected. See <a href='authuserprogram.html'>AuthUserProgram</a> for more information.</p>

<h1 id='example'>Example</h1>

<p>Most people want to see an example first:</p>

<ul>
<li><a href='http://coop.butterfat.net/~bmuller/mod_auth_openid/othersecret'>http://coop.butterfat.net/~bmuller/mod_auth_openid/othersecret</a> (uses default login page)</li>

<li><a href='http://coop.butterfat.net/~bmuller/mod_auth_openid/secret'>http://coop.butterfat.net/~bmuller/mod_auth_openid/secret</a> (uses <a href='custompage.html'>custom login page</a>)</li>
</ul>

<h1 id='installation'>Installation</h1>

<p><em>These docs assume that you have <a href='http://httpd.apache.org'>Apache 2</a> installed and running already.</em></p>

<h2 id='prerequisites'>Prerequisites</h2>

<ul>
<li>libopkele (&gt;= 2.0): a C++ implementation of important OpenID functions - <a href='http://kin.klever.net/libopkele/'>http://kin.klever.net/libopkele/</a></li>

<li>libsqlite: SQLite C libs - <a href='http://www.sqlite.org'>http://www.sqlite.org</a></li>
</ul>

<h2 id='get_the_source'>Get The Source</h2>

<p>You can download the current stable release from <a href='releases.html'>the releases page</a> or use <a href='http://subversion.tigris.org'>Subversion</a> to get a development release:</p>
<div class='highlight'><pre><code class='bash'>git clone git://github.com/bmuller/mod_auth_openid.git
</code></pre>
</div>
<p><em>Note that if you download a development release you will need current versions of the autotools installed, and you must run ./autogen.sh first before following these instructions.</em></p>

<h2 id='compile'>Compile</h2>

<p>Enter the mod_auth_openid directory and type:</p>
<div class='highlight'><pre><code class='bash'>./configure
</code></pre>
</div>
<p>You can use the following to see additional configuration options:</p>
<div class='highlight'><pre><code class='bash'>./configure --help
</code></pre>
</div>
<p>Then:</p>
<div class='highlight'><pre><code class='bash'>make
su root
make install
</code></pre>
</div>
<p>Verify that the module has been enabled in your &#8221;httpd.conf&#8221;:</p>
<div class='highlight'><pre><code class='apache'><span class='c'># note that the path to your module might be different</span>
<span class='nb'>LoadModule</span> authopenid_module <span class='sx'>/usr/lib/apache2/modules/mod_auth_openid.so</span>
</code></pre>
</div>
<p>Depending on where you specify your AuthOpenIDDBLocation (see below), you may need to touch the db file as the user that&#8217;s running Apache (or chown the directory it&#8217;s being stored in). For instance:</p>
<div class='highlight'><pre><code class='bash'><span class='c'># /tmp/mod_auth_openid.db is the default location for the DB</span>
su root
touch /tmp/mod_auth_openid.db
chown www-data /tmp/mod_auth_openid.db
</code></pre>
</div>
<h2 id='usage'>Usage</h2>

<p>Place the following directive in either a Directory, Location, or File directive in your httpd.conf (or in an .htaccess file if you have <em>AllowOverride AuthConfig</em>):</p>
<div class='highlight'><pre><code class='apache'><span class='nb'>AuthOpenIDEnabled</span>                 <span class='k'>On</span>
</code></pre>
</div>
<ul>
<li><strong>AuthOpenIDEnabled</strong>: The directory/location/file should be secured by mod_auth_openid. This is the only required directive. The following are optional:</li>
</ul>
<div class='highlight'><pre><code class='apache'><span class='nb'>AuthOpenIDDBLocation</span>              <span class='sx'>/some/location/my_file.db</span>
<span class='nb'>AuthOpenIDTrusted</span>                 ^http://myopenid.com/server$ ^http://someprovider.com/idp$
<span class='nb'>AuthOpenIDDistrusted</span>              ^http://hackerdomain ^http://openid.microsoft.com$ 
<span class='nb'>AuthOpenIDUseCookie</span>               <span class='k'>Off</span>
<span class='nb'>AuthOpenIDTrustRoot</span>               http://example.com
<span class='nb'>AuthOpenIDCookieName</span>              example_cookie_name
<span class='nb'>AuthOpenIDLoginPage</span>               <span class='sx'>/login.html</span>
<span class='nb'>AuthOpenIDCookieLifespan</span>          <span class='m'>3600</span> # one hour
<span class='nb'>AuthOpenIDServerName</span>              http://example.com
<span class='nb'>AuthOpenIDUserProgram</span>             <span class='sx'>/path/to/authorization/program</span>
<span class='nb'>AuthOpenIDCookiePath</span>              <span class='sx'>/path/to/protect</span>
</code></pre>
</div>
<ul>
<li><strong>AuthOpenIDDBLocation</strong>: Specifies the place the BDB file should be stored. <em>Default:</em> /tmp/mod_auth_openid.db.</li>

<li><strong>AuthOpenIDTrusted</strong>: If specified, only users using providers that match one of the (Perl compatible) regular expressions listed will be allowed to authenticate. <em>Default:</em> Trust all providers.</li>

<li><strong>AuthOpenIDDistrusted</strong>: If specified, only users using providers that do not match one of the (Perl compatible) regular expressions listed will be allowed to authenticate. You can use this in combination with AuthOpenIDTrusted; in that case, only a domain that is listed as trusted and not listed as distrusted can be used. <em>Default:</em> No providers are distrusted.</li>

<li><strong>AuthOpenIDUseCookie</strong>: If &#8220;Off&#8221;, then a session cookie will not be set on the client upon successful authentication. The page will load once; if reloaded or if the user visits it again it will ask the user to reauthenticate. <em>Default:</em> On</li>

<li><strong>AuthOpenIDTrustRoot</strong>: User&#8217;s are asked to approve this value by their identity provider after redirection. Most providers will error out unless this value matches the URL they are being redirected from, or some subset of that URL. For instance, if a user is trying to access <strong>http://example.com/protected/index.html</strong> then either <strong>http://example.com</strong> or <strong>http://example.com/protected/</strong> would work but <strong>http://example.com/protected/area/</strong> would not. <em>Default:</em> The URL the user is trying to access (without filenames / query parameters at the end).</li>

<li><strong>AuthOpenIDCookieName</strong>: The name of the session cookie set by mod_auth_openid. <em>Default:</em> open_id_session_id</li>

<li><strong>AuthOpenIDLoginPage</strong>: The URL location of a customized login page. This could be a location on a different server or domain. <em>Default:</em> use the mod_auth_openid login page that exists in the module. See the <a href='custompage.html'>custom login page howto</a> for more information.</li>

<li><strong>AuthOpenIDCookieLifespan</strong>: The number of seconds that the session cookie should live after being set. <em>Default:</em> If the cookie lifespan is not set than it will expire at the end of the browser session (when the browser is closed).</li>

<li><strong>AuthOpenIDServerName</strong>: If mod_auth_openid is being used behind a proxy, this option can be used to specify a hostname that will be used to create redirection URLs. For more info, see #3.</li>

<li><strong>AuthOpenIDUserProgram</strong>: A user specified program for authorization functions. Please please oh please read AuthUserProgram before using this.</li>

<li><strong>AuthOpenIDCookiePath</strong>: Explicitly set the path of the auth cookie (for instance, if you want to explicitly grant access to a location other than the one the user is trying to access). For more info, see #76. Next, restart apache:</li>
</ul>
<div class='highlight'><pre><code class='bash'>/path/to/apache2/bin/apachectl stop
/path/to/apache2/bin/apachectl start
</code></pre>
</div>
<p>After a user authenticates themselves, the user&#8217;s identity will be available in the <em>REMOTE_USER</em> cgi environment variable. A cookie named <em>open_id_session_id</em> is saved to maintain each user&#8217;s session.</p>

<h1 id='upgrading'>Upgrading</h1>

<p>If you&#8217;re upgrading, make sure you delete the old database file before upgrading and after stopping apache.</p>

<h1 id='attribute_exchange'>Attribute Exchange</h1>

<p>See the <a href='attex.html'>AttributeExchange</a>.</p>

<h1 id='questionsproblemscomplaints'>Questions/Problems/Complaints</h1>

<p>First, read the <a href='faq.html'>FAQ</a>. If it&#8217;s a bug, report it by creating a new ticket (link at top). If it&#8217;s a complaint or question, email <a href='https://lists.butterfat.net/mailman/listinfo/mod-auth-openid'>the mailing list</a>.</p>
    </div>
    <div id="footer"></div>
  </body>
</html>
